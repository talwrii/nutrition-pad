#!/home/bruger/mine/nutrition-pad/.venv-test/bin/python3
"""Take a screenshot of a URL, optionally hovering over an element.

Usage: take-screenshot URL [OUTPUT] [--hover SELECTOR] [--hover-index N]
"""
import argparse
import sys

def main():
    parser = argparse.ArgumentParser(description="Take a screenshot of a URL")
    parser.add_argument("url", help="URL to screenshot")
    parser.add_argument("output", nargs="?", default="screenshots/dev.png", help="Output path (default: screenshots/dev.png)")
    parser.add_argument("--hover", help="CSS selector to hover over")
    parser.add_argument("--hover-index", type=int, default=0, help="Index of matched element to hover (default: 0)")
    parser.add_argument("--width", type=int, default=900)
    parser.add_argument("--height", type=int, default=1200)
    args = parser.parse_args()

    from playwright.sync_api import sync_playwright
    with sync_playwright() as p:
        browser = p.chromium.launch()
        page = browser.new_page(viewport={"width": args.width, "height": args.height})
        page.goto(args.url)
        page.wait_for_load_state("networkidle")
        if args.hover:
            els = page.query_selector_all(args.hover)
            if els and args.hover_index < len(els):
                els[args.hover_index].hover()
                page.wait_for_timeout(300)
            else:
                print(f"Warning: found {len(els)} elements for '{args.hover}', index {args.hover_index}", file=sys.stderr)
        page.screenshot(path=args.output, full_page=True)
        browser.close()
    print(args.output)

if __name__ == "__main__":
    main()
